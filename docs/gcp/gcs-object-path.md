# GCS オブジェクトパス（プレフィックス）のベストプラクティス

## 概要

バケット内のオブジェクトをどういう「フォルダ」構成で保存するかの方針。GCS はフラットな名前空間なので、`/` を含むオブジェクト名で擬似的な階層を作る。

---

## 1. プレフィックス名の選び方

### よく使われるプレフィックス

| プレフィックス      | 意味・用途 |
|---------------------|------------|
| `uploads/`          | ユーザーアップロード全般。**汎用的で多くのサービスで使われる**。 |
| `images/`           | 画像専用であることを明示したいとき。バケットが画像専用なら分かりやすい。 |
| `user-uploads/`     | 「ユーザーが上げたもの」を明示。後から `system/` や `temp/` などと並べるときに役立つ。 |
| `hand-images/` など | ドメイン固有（例: 手牌画像のみ）にしたいとき。用途が固定なら検索・ライフサイクルで使いやすい。 |

**結論**: 「汎用性」を重視するなら **`uploads/`** で問題ない。業界でもよく使われている。用途をはっきりさせたいなら `images/` や `user-uploads/`、ドメインを出したいなら `hand-images/` などが候補。

---

## 2. 日付パーティション（任意）

プレフィックスの下に **日付** を入れる方式。例: `uploads/2025/02/03/1738xxxxx-photo.jpg`。

### メリット

- **ライフサイクル**: 「90日過ぎたオブジェクトを削除」などをプレフィックス（日付）単位で設定しやすい。
- **一覧・分析**: 特定日のオブジェクトだけ List API の `prefix` で取得できる。
- **運用**: 日付で整理され、障害調査や監査で「いつ頃のデータか」が分かりやすい。

### デメリット

- パスが長くなる。
- 実装で日付を組み立てる必要がある（1行程度で済む）。

### 例

```
uploads/2025/02/03/1738123456789-user_photo.jpg
images/2025-02-03/1738123456789-image.png
```

---

## 3. このプロジェクトでの方針

- **プレフィックス**: **`uploads/`** を使用（`frontend/lib/gcs-client.ts`）。
- **日付パーティション**: **採用済み**。パスは `uploads/YYYY/MM/DD/{timestamp}-{fileName}`。日付は UTC。  
  ライフサイクルや日付単位の一覧に利用できる。

---

## 4. 参考

- [Best practices for Cloud Storage](https://cloud.google.com/storage/docs/best-practices)
- [Strategy for day folders in google cloud storage](https://stackoverflow.com/questions/69958348/strategy-for-day-folders-in-google-cloud-storage) — 日付フォルダの考え方
- ライフサイクル: プレフィックス指定で「何日後に削除」などを設定可能
