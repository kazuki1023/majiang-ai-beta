# 入力導線とレイアウトの検討

## 概要

画像アップロードから手牌・場風・自風などを読み取り、誤りがあればその場で修正してから「チャットに投げる」という導線を想定している。現状の上から並べたレイアウトでは導線が分かりにくいため、ユーザーの流れに沿った見た目を検討する。

---

## 1. 想定するユーザー導線（将来）

1. **画像をアップロードする**
   ユーザーが手牌の写真（または牌譜画像）をアップロードする。
2. **画像を解析する**
   バックエンド（imageRecognitionAgent 等）が画像から手牌・場風・自風・ドラ表示牌などを読み取る。
3. **読み取った情報を返す**
   解析結果を画面上に表示する（手牌の牌表示、場風・自風の選択状態など）。
4. **誤りがあればその場で修正する**
   ユーザーが手牌の追加/削除、場風・自風・ドラの変更で修正する。
5. **チャットに投げる**
   確定した内容で分析 API に送信し、分析結果を表示する（＝「チャットに投げる」）。

※ 手動入力だけを使うユーザーは「手で入力」タブに切り替え、手牌選択・場風・自風を入力して「投げる」流れになる。

---

## 2. 採用方針：画像ファースト ＋ タブ切り替え ＋ 段階的表示

### 基本方針

- **最初に表示するのは画像アップロード**  
  デフォルトで見えるのは「画像をアップロードする」部分。ここが導線の入口。
- **手で入力する人はタブで切り替え**  
  「画像で入力」が基本。手入力したい人だけタブ（例: 「写真から」「手で入力」）で「手で入力」に切り替える。タブを切り替えると、現状ある牌選択・場風・自風などの UI が使える。
- **返り値が返ってきたら、その下に読み取った情報を表示**  
  画像をアップロードして認識 API の返り値が返ってきたら、**その下に**読み取った内容を表示する。表示する UI は現状と同じ「選択した手牌」「牌を選ぶ」「場風・自風・ドラ・巡目」を、**認識結果で入力済みの状態**で出す。ユーザーは写真と見比べながら誤りを修正できる。
- **修正できたら分析をかける**  
  写真と見比べて問題なければ（または修正し終えたら）「分析する」で送信。最適な打牌などを教えてもらう。
- **最初から全部出さない（段階的表示）**  
  認知負荷を下げるため、最初は画像アップロードだけ（またはタブ選択）を表示し、**流れに応じて必要なブロックを順に表示する**。認識結果が返ってきたら「手牌・場風・自風などのブロック」が出現、といった「どんどん表示される」形を想定する。

### 導線の流れ（画像を使う場合）

1. 画面を開く → **画像アップロード**が最初に見える（＋「手で入力」タブあり）
2. 画像をアップロード → 認識 API 呼び出し
3. 返り値が返る → **その下に**「選択した手牌」「牌を選ぶ」「場風・自風・ドラ・巡目」が認識結果で入力された状態で表示される
4. ユーザーが写真と見比べて必要なら修正
5. 「分析する」で送信 → 最適な打牌などの分析結果が表示される

### 導線の流れ（手で入力する場合）

1. 画面を開く → 「手で入力」タブを選択
2. タブ切り替え後、現状どおりの牌選択・場風・自風・ドラ・巡目・分析ボタンが表示される
3. 入力して「分析する」で送信

### 補足

- 認識結果の表示に使う UI は、手動入力タブのもの（ShoupaiInputForm 相当）と共通化し、**初期値が「空」か「認識結果」か**で切り替える想定。
- 段階的表示にするため、ページ初期表示では「選択した手牌」「牌を選ぶ」などのブロックは出さず、画像フローでは「認識結果が返ってきたとき」に初めて表示する形がよい。

---

## 3. 現状の見た目と課題（参考）

### 現状の並び（上から下）

| 順序 | ブロック | 内容 |
|------|----------|------|
| 1 | 選択した手牌 | 手牌プレビュー（牌画像）＋ 枚数表示 |
| 2 | 牌を選ぶ箇所 | 萬子・筒子・索子・字牌のボタン群 |
| 3 | 場風・自風・ドラ・巡目 | 各選択 UI |
| 4 | 分析ボタン | 送信トリガー |
| 5 | 画像アップロード | ファイル選択 ＋ アップロード ＋ プレビュー |

### 課題

- **画像が最後にある**
  「まず画像を上げる」導線なのに、画像アップロードが一番下で、流れとして見つけにくい。
- **入力方法が並列で分かりにくい**
  手動入力（牌選択）と画像入力が同じ画面に同じ重さで並んでおり、「どちらを先にやるか」が伝わりにくい。
- **「認識 → 修正 → 投げる」のステップが視覚化されていない**
  画像で読み取った結果をどこで確認・修正し、どこで「分析に送る」かがレイアウトから読み取りにくい。
- **「チャットに投げる」感が弱い**
  分析ボタンがフォームの一部になっており、メッセージを送るような一体感が出にくい。

---

## 4. レイアウト案（検討時のメモ）

### 案 A: 画像ファースト（ステップを縦に並べる）

**構成**

1. **一番上: 画像アップロード**
   「手牌の写真をアップロード」のブロックを最上部に配置。
2. **その下: 認識結果＋修正**
   画像解析後、同じ画面内に「読み取った手牌・場風・自風・ドラ」を表示し、その横または下に修正用 UI（牌の追加/削除、場風・自風の変更など）を配置。
3. **その下: 送信**
   「この内容で分析する」ボタン（＝チャットに投げる）を配置。
4. **手動入力**
  「画像を使わず手で入力する」は折りたたみやリンクで開く、または「手動入力」タブで別ブロックに分離。

**メリット**
- 導線が「画像 → 確認・修正 → 投げる」と一直線で分かりやすい。
- 画像ありユーザーと手動のみユーザーで、同じ「入力 → 送信」の流れに乗せやすい。

**デメリット**
- 画像なしで使うユーザーは、いったん「手動入力」を開く必要がある。
- 認識結果ブロックの高さや情報量によっては縦に長くなる。

---

### 案 B: 入力方法を先に選ぶ（カード or タブ）

**構成**

1. **最初の選択**
   「写真から入力」「手で入力」の 2 つをカードまたはタブで並べる。
2. **写真から入力**を選んだ場合
   アップロード → 認識結果表示 → 修正 UI → 「分析に送る」ボタン、を縦に並べる（案 A の 1〜3 に相当）。
3. **手で入力**を選んだ場合
   現状の牌選択・場風・自風・ドラ・分析ボタンのブロックを表示。

**メリット**
- 入力方法が明確で、「今は写真」「今は手入力」が切り替えで分かる。
- 画像フローと手動フローを UI 上で分離できる。

**デメリット**
- 最初の 1 クリックが増える。
- 写真で読み取ったあと手動で直すのは「写真から入力」内の修正 UI で完結するが、手動に切り替えたときの状態引き継ぎをどうするか要検討。

---

### 案 C: チャット風の入力エリア

**構成**

1. **入力エリアを 1 ブロックにまとめる**  
   見た目を「メッセージを書く欄」に近づける。  
   - 上部または左側: 画像添付ボタン（クリックでアップロード、プレビューを入力欄の上に表示）。  
   - その下: 手牌・場風・自風などは、コンパクトな 1 行〜数行の要約（例: 手牌の牌並び＋「東家・南風・ドラ 1 索」）と「編集」で展開する詳細フォーム。
2. **送信**  
   「分析する」（送信）ボタンは入力エリアの右端または下に 1 つ。

**メリット**  
- 「チャットに投げる」感が強く、入力 → 送信の流れが 1 本化できる。  
- 画像ありのときは「添付 ＋ 認識結果の要約」が同じ入力ブロック内に収まる。

**デメリット**  
- 手牌・場風・自風・ドラをすべて「要約＋編集」にまとめる設計が必要。  
- 現状の大きな牌選択 UI をそのまま載せるとチャット風からは外れるため、コンパクト化や段階的開示の検討が必要。

---

### 案 D: 画像と手動を同じ「入力パネル」に統合

**構成**

1. **入力パネル（左 or 上）**  
   - 画像: ドラッグ＆ドロップ or クリックでアップロード。アップロード後はサムネイル＋「認識する」ボタン。  
   - 認識結果: 手牌・場風・自風・ドラを表示し、その場で編集可能（牌の追加/削除、プルダウン変更など）。  
   - 画像を使わない場合: 最初から手牌選択・場風・自風の UI を表示（現状に近い）。  
2. **送信**  
   入力パネル内の「分析する」で送信。  
3. **結果エリア（右 or 下）**  
   分析結果をチャットのように表示。

**メリット**  
- 「入力はここ、結果はここ」が分かりやすい。  
- 画像あり・なしを同じパネルで扱え、認識結果の修正も同じ場所で完結できる。

**デメリット**  
- レイアウト（左右分割 or 上下分割）とレスポンシブの検討が必要。  
- 入力パネルに情報が集約するため、情報設計（何を常時表示し、何を折りたたむか）の整理が必要。

---

上記「採用方針」は、案 A（画像ファースト）＋ 案 B のタブ（手で入力に切り替え）＋ **段階的表示**を組み合わせた形。

## 5. 比較の観点（参考）

| 観点 | 案 A | 案 B | 案 C | 案 D |
|------|------|------|------|------|
| 画像ファーストの分かりやすさ | ◎ | ◎ | ○ | ◎ |
| 手動入力のみの手軽さ | △ | ○ | ○ | ○ |
| 「チャットに投げる」感 | ○ | ○ | ◎ | ○ |
| 実装コスト（現状からの変更量） | 中 | 中〜大 | 大 | 大 |
| モバイルでの使いやすさ | 要検証 | タブは相性良い | 要検証 | 要検証 |

---

## 6. 今後の進め方（案）

1. **採用方針に沿ったワイヤー / Figma**  
   - 初期表示: 画像アップロード ＋ 「写真から」「手で入力」タブ。
   - 認識結果返却後: その下に「選択した手牌」「牌を選ぶ」「場風・自風・ドラ・巡目」が出現する状態を図で固める。
2. **手で入力タブ**  
   タブ「手で入力」選択時は、現状の ShoupaiInputForm（牌選択・場風・自風・ドラ・巡目・分析ボタン）をそのまま表示。画像フロー用の「認識結果で初期化したフォーム」と UI コンポーネントは共通化する。
3. **ドラ表示牌・巡目**  
   [dora-indicator-ux.md](./dora-indicator-ux.md) と整合させ、認識結果・修正 UI にどう載せるか決める。
4. **Phase 4（画像認識）実装時**  
   アップロード → 認識 API 呼び出し → **返り値でフォームを初期化して段階表示** → 修正 → 送信、の状態管理とコンポーネント分割を実装する。

---

## 7. 関連ドキュメント

- [dora-indicator-ux.md](./dora-indicator-ux.md) — ドラ表示牌の入力 UI
- [pai-display-design.md](./pai-display-design.md) — 牌表示の設計（画像利用）
- [frontend-implementation-plan.md](../frontend-implementation-plan.md) — Phase 3/4 の実装範囲
