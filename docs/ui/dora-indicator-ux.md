# ドラ表示牌のUI/UX検討

## 概要

分析時に「ドラ表示牌」をユーザーが指定する必要がある。現状は**テキスト入力**（例: `s3`）だが、正しい牌IDを覚えて入力する負荷が高く、複数枚（カンドラ等）にも対応しづらい。このドキュメントでは、ドラ表示牌の入力方法について複数のUI案を比較し、メリット・デメリットを整理する。

## 前提・要件

- **ドラ表示牌は複数枚あり得る**
  王牌の1枚目だけでなく、カンドラがある場合は2枚目・3枚目…も指定する必要がある。API（mastra）は `baopai: string[]` で配列を受け付ける想定。
- **現状のフロント**
  `baopai: string` の1つのテキストフィールドで、ユーザーが `s3` などの文字列を直接入力する形。複数枚は未対応。
- **目指すUX**
  手牌と同様に「牌を選ぶ」操作で指定でき、複数枚も自然に扱えること。

---

## 案1: モーダルでドラ表示牌を選択

### 概要

「ドラ表示牌」のラベルや入力欄をタップ/クリックするとモーダルが開き、モーダル内に34種の牌を並べて選択する。選択した牌は「選択済みドラ表示牌」としてリスト表示し、順序の入れ替え・削除も可能にする。

### メリット

- **1タップで選択開始**  
  select のように「開く→選ぶ」の2段階にならない。モーダルを開けばすぐ牌を選べる。
- **手牌入力と干渉しない**  
  手牌エリアはそのままに、ドラだけ別画面で集中して編集できる。
- **複数枚の追加・削除が明確**  
  リスト形式にすれば、1枚目・2枚目…の並びと枚数が一目で分かる。カンドラの追加も「牌を1枚追加」で表現しやすい。
- **入力ミスがほぼない**  
  牌IDを覚えずに、見た目で選べる。

### デメリット

- **画面遷移・オーバーレイ**  
  モーダルを開く/閉じる操作が増え、シンプルな1画面フローよりステップが増える。
- **実装コスト**  
  モーダル、牌選択UI、選択済みリストの並び替え/削除の実装が必要。
- **「今のドラ」の見え方**  
  モーダルを閉じているときは、現在のドラ表示牌が「要約表示」（例: 「3索, 4筒」や枚数だけ）になるため、詳細はモーダルを開かないと見られない。要約の仕方によっては情報が不足する可能性がある。

### 補足

- モーダル内で「牌をタップで追加 → 上に並んだリストで削除・並び替え」にすると、カンドラの順序も正確に伝えられる。
- 既存の牌ボタン（`TileButton`）や `TILE_SET_BY_SUIT` を流用しやすい。

---

## 案2: 手牌選択タブとドラ表示牌選択タブの2タブ構成

### 概要

画面上部（または入力エリア内）に「手牌」「ドラ表示牌」などのタブを設け、タブ切り替えで入力内容を変える。ドラ表示牌タブでは、手牌と同様に牌をクリックで「ドラ表示牌リスト」に追加し、複数枚・順序を管理する。

### メリット

- **役割が分かりやすい**  
  「今は手牌を編集している」「今はドラを編集している」がタブで明確。
- **同じ牌選択UIを再利用**  
  手牌タブで使っている牌セレクターとほぼ同じUIをドラタブでも使える。学習コストが低い。
- **複数枚を同じ操作感で**  
  ドラタブで「牌を選ぶ → リストに追加」を繰り返せば、カンドラも同じ操作で追加できる。
- **モーダルより「画面内」**  
  タブ切り替えだけなので、モーダルの開閉のようなオーバーレイが不要。

### デメリット

- **タブ切り替えが必須**  
  手牌とドラを同時には見られない。ドラを確認・編集するたびにタブを切り替える必要がある。
- **初回利用時の発見性**  
  「ドラ表示牌は別タブ」と気づかないユーザーがいる可能性。ラベルや説明で補う必要がある。
- **レイアウトの制約**  
  タブ＋各タブの内容を1画面に収めると、携帯では縦に長くなり、手牌タブとドラタブの両方の存在を把握しづらくなる場合がある。

### 補足

- ドラが0枚でも可（未選択のまま送信し、APIで `baopai: []` とする）。
- タブは「手牌」「ドラ表示牌」の2つにし、場風・自風・巡目などは手牌タブ内か共通エリアに置く形が扱いやすい。

---

## 案3: 同一画面内の「ドラ表示牌」セクション（インライン）

### 概要

手牌選択の下（または横）に、常に見えている「ドラ表示牌」セクションを設ける。そこに「追加」ボタンまたは牌のミニセレクターを置き、タップした牌がドラ表示牌として並ぶ。選択済みの牌は手牌と同様に横並びで表示し、タップで削除できる。

### メリット

- **手牌とドラを同じ画面で確認・編集できる**  
  タブやモーダルなしで、文脈を切り替えずに操作できる。
- **実装が比較的シンプル**  
  既存の牌ボタン＋リスト表示の延長で実装しやすい。
- **「今のドラ」が常に可視**  
  要約ではなく、選んだ牌がそのまま並んで見える。

### デメリット

- **画面が縦に長くなる**  
  手牌エリア＋牌セレクター＋場風・自風・巡目に加えてドラセクションがあると、携帯ではスクロールが増える。
- **牌セレクターが2系統になる**  
  「手牌用の牌」と「ドラ用の牌」で、同じ34種を2回並べるか、共通のピッカーを「いまどちらに追加するか」で切り替える必要がある。後者は状態設計がやや複雑。
- **ドラが複数枚のときの占有スペース**  
  ドラ表示牌を横並びで全部出すと、枚数に応じて幅を取る。折り返すと2行になり、案1・2と同様に「複数枚の見せ方」の工夫が必要。

---

## 案4: アコーディオン（折りたたみ）でドラ表示牌を開く

### 概要

「場風・自風・ドラ・巡目」をまとめたブロックのうち、「ドラ表示牌」だけアコーディオン（`<details>` 等）にして、開いたときだけ牌選択UIを表示する。

### メリット

- **普段はコンパクト**  
  ドラをいじらないユーザーには閉じたままにでき、画面を占有しない。
- **開けば案3に近い**  
  開いた中身は「インラインの牌選択」にできる。

### デメリット

- **「ドラがある」ことが伝わりにくい**  
  閉じているとき、ドラを設定したかどうかが分かりにくい。見出しに「ドラ表示牌（2枚）」のように枚数だけ出しても、中身は開かないと分からない。
- **開閉の一手間**  
  ドラを確認・編集するたびに開閉が必要。タブと同様、発見性と操作回数のトレードオフがある。

---

## その他の検討ポイント

- **0枚の扱い**  
  ドラなし（未設定）を許すか。許す場合は「ドラ表示牌を設定しない」という選択ができるUIがあるとよい。
- **順序の編集**  
  カンドラの順序を間違えたときに、並び替えや「この1枚を削除」ができると親切。
- **デフォルト**  
  多くの局ではドラ表示牌は1枚。初期状態を「0枚」にするか「1枚だけ未選択の状態で枠を1つ表示」にするかは、他案と合わせて決めたい。
- **APIとの対応**  
  フロントは `baopai: string[]` で管理し、送信時に配列のまま渡す形にすると、既存のmastra側と整合しやすい。

---

## 比較まとめ

| 観点                 | 案1: モーダル     | 案2: タブ         | 案3: インライン   | 案4: アコーディオン |
|----------------------|-------------------|--------------------|--------------------|------------------------|
| 操作ステップ         | 開く→選ぶで明確   | タブ切り替えが必要 | その場で選べる     | 開く→選ぶ             |
| 複数枚の見せ方       | リストで明確      | リストで明確       | 横並びで可視       | 開いた中でリスト       |
| 画面の占有           | 開いている間のみ  | 1タブ分            | 常に一定領域       | 閉じれば小            |
| 手牌と同時に見られる | 否                | 否                 | 是                 | 是（開いていれば）    |
| 実装コスト           | 中〜大            | 中                 | 小〜中             | 小                    |
| 携帯での使いやすさ   | モーダルはやや重い | タブは一般的       | スクロール増       | 閉じれば軽い          |

---

## 結論・推奨の方向性（案）
