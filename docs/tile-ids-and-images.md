# 牌IDと赤牌・画像ファイル名

majiang-core / majiang-ai（submodules）での牌の表記と、フロントエンドの牌ID・画像名の対応をまとめる。

## 1. submodules での赤牌の扱い

### 牌ID（1枚の牌を表す文字列）

- **数牌**: `m1`〜`m9`（萬子）, `p1`〜`p9`（筒子）, `s1`〜`s9`（索子）
- **字牌**: `z1`〜`z7`（東南西北白發中）
- **赤牌**: **数値に `0` を使う**
  - `m0` = 赤五萬
  - `p0` = 赤五筒
  - `s0` = 赤五索
  - 字牌に赤はない（`z0` は無効）

### 根拠（submodules 内）

- **majiang-core `lib/shoupai.js`**
  - `_bingpai`: 各スートの配列で **添字 0 が赤牌の枚数**。`n = 0` のときは「五」の一種として `bingpai[s][5]` もインクリメント。
  - `replace(/0/g,'5')`: 和了判定などでは赤を 5 に正規化（役の計算では赤かどうかは無関係）。
- **majiang-ai `legacy/player-0504.js`**
  - `add_hongpai`: 聴牌リストで「5」があるとき、その牌の「0」版（赤）も追加。`p.replace(/5/,'0')`。
- **majiang-ai `legacy/suanpai-0504.js`**
  - `+dapai.p[1]||5`: 打牌の数字が 0 のとき 5 として扱う（枚数計算）。
- **テスト例** (`submodules/majiang-ai/test/player.js`): `shoupai:'m188p3346789s113m0'`, `s3078s9`, `m147p1s0z22333z4` などで `m0`, `p0`, `s0` が使われている。

## 2. 手牌文字列での表記

- 例: `m123p405s789z12` → 萬子123、筒子4・**赤五**・5、索子789、字牌12
- 同種複数枚: `m000` は赤五萬3枚（実際のルールでは各スート1枚までだが、表記上は 0 が並ぶ）

## 3. 画像ファイル名との対応

フロントエンドでは **牌IDをそのまま画像ファイル名**にすると、API・手牌文字列と一致する。

| 種別   | 牌ID   | 画像ファイル名例 | 備考           |
|--------|--------|------------------|----------------|
| 萬子   | m1〜m9 | m1.gif 〜 m9.gif |                |
| 萬子・赤 | m0     | m0.gif           | 赤五萬         |
| 筒子   | p1〜p9 | p1.gif 〜 p9.gif |                |
| 筒子・赤 | p0     | p0.gif           | 赤五筒         |
| 索子   | s1〜s9 | s1.gif 〜 s9.gif |                |
| 索子・赤 | s0     | s0.gif           | 赤五索         |
| 字牌   | z1〜z7 | z1.gif 〜 z7.gif | 東南西北白發中 |

civillink の「赤ウーピン」「赤ウーソー」「赤ウーマン」は、ダウンロード後に **p0.gif**, **s0.gif**, **m0.gif** として保存すると、`getTileLabel("m0")` で「五萬」などのラベルと、画像 `m0.gif` が一貫して紐づく。

## 4. フロントエンド（shoupai-utils）での扱い

- **牌ID**: `m0`, `p0`, `s0` を赤牌として定義し、`TILE_SET` / `TILE_SET_BY_SUIT` に含める（手牌入力で「赤五」を選べるようにする場合）。
- **表示ラベル**: 赤も通常の五と同じ「五萬」「⑤筒」「５索」でよい（見た目は画像で区別）。
- **手牌文字列との変換**: `shoupaiStringToTileIds` は既に数牌の `0` を 1 桁ずつ展開する。`selectedTilesToShoupaiString` では `num === 0` の牌を `0` として出力するので、m0 を選ぶと手牌文字列に `0` が含まれる。
